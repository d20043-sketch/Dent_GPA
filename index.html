<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SKGZ3KNR14"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-SKGZ3KNR14');
    </script>


    <meta charset="UTF-8">
    <meta name="google-site-verification" content="X9oORb8LFYD38B4c7vNz9HDdK1guR19knfI-kO1xUZU" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Calculate your BDS CGPA, track academic goals and honours for dental students.">
    <title>Dent_GPA</title>

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* ===================================
           RESET & BASE STYLES
           =================================== */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        /* ===================================
           CSS VARIABLES (THEME COLORS)
           =================================== */
        :root {
            --primary: #2563eb;
            --danger: #dc2626;
            --success: #16a34a;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #0f172a;
            --muted: #64748b;
            --input-bg: #ffffff;
            --input-border: #cbd5e1;
            --context-bg: #eff6ff;
            --context-border: #dbeafe;
            --cgpa-bg: #f8fafc;
            --border: #f1f5f9;
            --dashed-border: #e2e8f0;
            --error-bg: #fef2f2;

            /* Honours Tier Colors (Traffic Light System) */
            --honours-first: #16a34a;
            /* Green - First Class ‚â•3.70 */
            --honours-second: #ca8a04;
            /* Yellow - Second Class ‚â•3.00 */
            --honours-below: #dc2626;
            /* Red - Below Second <3.00 */
        }

        /* Dark theme overrides */
        :root[data-theme="dark"],
        [data-theme="dark"] {
            --bg: #0b1220;
            --card: #07101a;
            --text: #e6eef8;
            --muted: #9fb0c8;
            --input-bg: #071a2a;
            --input-border: #123241;
            --context-bg: #062033;
            --context-border: #123244;
            --cgpa-bg: #071a2a;
            --border: rgba(255, 255, 255, 0.04);
            --dashed-border: rgba(255, 255, 255, 0.06);
            --error-bg: #3b0b0b;

            /* Honours Tier Colors - Dark Mode (Brighter for visibility) */
            --honours-first: #22c55e;
            /* Bright Green - First Class */
            --honours-second: #fbbf24;
            /* Bright Yellow - Second Class */
            --honours-below: #f87171;
            /* Bright Red - Below Second */
        }

        /* ===================================
           LAYOUT & CONTAINER
           =================================== */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 16px;
            line-height: 1.5;
            transition: background-color 220ms linear, color 220ms linear;
        }

        .container {
            position: relative;
            max-width: 480px;
            margin: 0 auto;
            background: var(--card);
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08);
            min-height: 300px;
            transition: background-color 220ms linear, color 220ms linear;
        }

        h2 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 12px;
            margin-top: 0;
            padding-top: 48px;
            font-weight: 800;
        }

        /* Theme toggle */
        .theme-toggle {
            position: absolute;
            right: 24px;
            top: 24px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid var(--input-border);
            color: var(--muted);
            padding: 6px 12px;
            border-radius: 999px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: 0.2s;
        }

        .theme-toggle:hover {
            background: rgba(37, 99, 235, 0.1);
        }

        .theme-toggle:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.08);
        }

        /* ===================================
           INFO & CONTEXT BOXES
           =================================== */


        .context-box {
            background: var(--context-bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            text-align: center;
            border: 1px solid var(--context-border);
        }

        label {
            font-weight: 600;
            font-size: 0.9rem;
            display: block;
            margin-bottom: 10px;
            color: var(--text);
        }

        select {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border-radius: 8px;
            border: 1px solid var(--input-border);
            background: var(--input-bg);
            color: var(--text);
            text-align: center;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
        }

        /* ===================================
           SEMESTER INPUT ROWS
           =================================== */
        .semester-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid var(--border);
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .sem-name {
            font-weight: 600;
            font-size: 0.95rem;
            display: block;
        }

        .sem-credits {
            font-size: 0.75rem;
            color: var(--muted);
        }

        input[type="number"] {
            width: 85px;
            padding: 10px;
            border: 1px solid var(--input-border);
            border-radius: 8px;
            text-align: center;
            font-size: 1.1rem;
            outline: none;
            transition: 0.12s;
            background: var(--input-bg);
            color: var(--text);
        }

        input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.08);
        }

        input.valid {
            border-color: var(--success);
            background: rgba(22, 163, 74, 0.05);
        }

        input.valid:focus {
            box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.08);
        }

        input.error {
            border-color: var(--danger);
            background: var(--error-bg);
        }

        .error-msg {
            display: block;
            color: var(--danger);
            font-size: 0.7rem;
            margin-top: 4px;
            text-align: center;
            font-weight: 500;
            animation: fadeIn 0.2s ease-in;
        }

        /* Helper Text */
        .start-hint {
            text-align: center;
            color: var(--muted);
            font-size: 0.9rem;
            margin-top: 40px;
            font-style: italic;
        }

        /* ===================================
           RESULTS & CGPA DISPLAY
           =================================== */
        .cgpa-box {
            text-align: center;
            background: var(--cgpa-bg);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .cgpa-title {
            font-size: 0.8rem;
            color: var(--muted);
            font-weight: bold;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .cgpa-value {
            font-size: 3rem;
            font-weight: 800;
            color: var(--primary);
            line-height: 1.1;
            margin: 5px 0;
            transition: color 0.3s ease;
        }

        /* Honours Tier Styling - 3 Tiers (Traffic Light) */
        .cgpa-box.tier-first {
            background: rgba(22, 163, 74, 0.08);
        }

        .cgpa-value.tier-first {
            color: var(--honours-first);
        }

        .cgpa-box.tier-second {
            background: rgba(202, 138, 4, 0.08);
        }

        .cgpa-value.tier-second {
            color: var(--honours-second);
        }

        .cgpa-box.tier-below {
            background: rgba(220, 38, 38, 0.08);
        }

        .cgpa-value.tier-below {
            color: var(--honours-below);
        }

        /* Dark mode - stronger background tints */
        [data-theme="dark"] .cgpa-box.tier-first {
            background: rgba(34, 197, 94, 0.12);
        }

        [data-theme="dark"] .cgpa-box.tier-second {
            background: rgba(251, 191, 36, 0.12);
        }

        [data-theme="dark"] .cgpa-box.tier-below {
            background: rgba(248, 113, 113, 0.12);
        }

        /* ===================================
           PROGRESS BAR
           =================================== */
        .progress-container {
            margin: 20px 0;
            padding: 16px;
            background: var(--context-bg);
            border: 1px solid var(--context-border);
            border-radius: 12px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text);
        }

        .progress-stats {
            font-size: 0.85rem;
            color: var(--muted);
        }

        .progress-bar-wrapper {
            width: 100%;
            height: 12px;
            background: rgba(0, 0, 0, 0.15);
            border-radius: 999px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .progress-bar-wrapper {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .progress-bar-fill {
            height: 100%;
            background: #22c55e;
            border-radius: 999px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .progress-percentage {
            text-align: center;
            margin-top: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary);
        }

        /* ===================================
           GOALS & REQUIREMENTS LIST
           =================================== */
        .goals-list {
            list-style: none;
            padding: 0;
        }

        .goal-item {
            padding: 12px 0;
            border-bottom: 1px dashed var(--dashed-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-impossible {
            color: var(--danger);
            font-weight: bold;
            font-size: 0.9rem;
        }

        .status-track {
            color: var(--success);
            font-weight: bold;
            font-size: 0.9rem;
        }

        .goal-val {
            font-weight: bold;
            font-size: 1rem;
        }

        /* Footer */
        .btn-reset {
            display: block;
            width: 100%;
            margin-top: 30px;
            padding: 12px;
            background: none;
            border: 1px dashed var(--input-border);
            color: var(--muted);
            border-radius: 8px;
            cursor: pointer;
            transition: 0.12s;
        }

        .btn-reset:hover {
            background: rgba(220, 38, 38, 0.06);
            color: var(--danger);
            border-color: var(--danger);
        }

        .btn-reset.confirm-state {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
            font-weight: bold;
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
        }

        .muted {
            color: var(--muted);
        }

        .muted-small {
            color: var(--muted);
            font-size: 0.8rem;
            margin-top: 6px;
        }

        /* Star Banner */
        .star-banner {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            max-width: 360px;
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            padding: 14px 16px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            animation: slideUp 0.3s ease-out;
            z-index: 1000;
        }

        @keyframes slideUp {
            from {
                transform: translateY(120%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .star-banner.hidden {
            display: none;
        }

        .star-banner-text {
            font-size: 0.9rem;
            line-height: 1.3;
            flex: 1;
        }

        .star-banner-link {
            display: inline-block;
            background: white;
            color: #2563eb;
            padding: 6px 12px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
            cursor: pointer;
            transition: 0.2s;
        }

        .star-banner-link:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .star-banner-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .star-banner-close:hover {
            transform: scale(1.2);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px 16px;
            margin-top: 40px;
            color: var(--muted);
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
        }

        .footer-name {
            font-weight: 600;
            color: var(--text);
        }

        .footer-batch {
            font-size: 0.8rem;
            margin-top: 4px;
        }
    </style>
</head>

<body>

    <main>
        <div class="container">
            <button id="theme-toggle" class="theme-toggle" aria-pressed="false">üåô Dark</button>
            <h2>Dent_GPA</h2>
            <p style="text-align: center; color: var(--muted); font-size: 0.9rem; margin: 0 0 24px 0;">Calculate Your
                BDS
                CGPA</p>



            <div class="context-box">
                <label for="current-sem-select">Semesters you have completed:</label>
                <select id="current-sem-select">
                    <option value="0" disabled selected>-- Tap to Select --</option>
                    <option value="1">1 Semester</option>
                    <option value="2">2 Semesters</option>
                    <option value="3">3 Semesters</option>
                    <option value="4">4 Semesters</option>
                    <option value="5">5 Semesters</option>
                    <option value="6">6 Semesters</option>
                    <option value="7">7 Semesters</option>
                    <option value="8">8 Semesters</option>
                    <option value="9">9 Semesters</option>
                    <option value="10">10 Semesters</option>
                </select>
            </div>

            <div id="semester-inputs"></div>

            <div id="results-panel" style="display:none; margin-top:30px;">
                <!-- Progress Indicator -->
                <div class="progress-container">
                    <div class="progress-header">
                        <span class="progress-title">üìä Degree Progress</span>
                        <span class="progress-stats" id="progress-stats">0/10 semesters</span>
                    </div>
                    <div class="progress-bar-wrapper">
                        <div class="progress-bar-fill" id="progress-bar-fill" style="width: 0%;"></div>
                    </div>
                    <div class="progress-percentage" id="progress-percentage">0% Complete</div>
                </div>

                <div class="cgpa-box">
                    <div class="cgpa-title" id="cgpa-label">Current CGPA</div>
                    <div class="cgpa-value" id="final-cgpa">0.00</div>
                    <div style="font-size:0.8rem; color:var(--muted);">Credits Attempted: <span
                            id="completed-credits">0</span>
                    </div>
                </div>

                <h3
                    style="font-size:1rem; margin-top:20px; color:var(--text); border-bottom: 2px solid var(--border); padding-bottom:10px;">
                    CGPA summary:</h3>
                <ul id="goals-list" class="goals-list"></ul>
            </div>

            <button class="btn-reset" id="reset-btn">Clear Data</button>

            <div class="footer">
                <div class="footer-name">Developed by Ramanitharan Kanishkar ü¶Ü</div>
                <div class="footer-batch"> 2020 Batch</div>
                <div style="margin-top: 12px; font-size: 0.75rem; color: var(--muted); line-height: 1.4;">
                    üîí <strong style="color: var(--text);">Privacy:</strong> All calculations are performed entirely on
                    your device. Your results are never sent to any server.
                </div>
            </div>
        </div>
    </main>

    <div class="star-banner" id="star-banner">
        <div class="star-banner-text">‚≠ê If this tool helped you, please consider giving it a star on GitHub!</div>
        <a href="https://github.com/d20043-sketch/Dent_GPA" class="star-banner-link" target="_blank"
            onclick="haptic(15);">Star on GitHub</a>
        <button class="star-banner-close" id="banner-close" aria-label="Dismiss" onclick="dismissBanner();">‚úï</button>
    </div>

    <script>
        /* ===================================
           JAVASCRIPT - MAIN APPLICATION
           =================================== */

        // ============ DATA STRUCTURES ============
        const semesterData = [
            { id: 1, name: "1st Semester GPA", credits: 14 },
            { id: 2, name: "2nd Semester GPA", credits: 15 },
            { id: 3, name: "3rd Semester GPA", credits: 17 },
            { id: 4, name: "4th Semester GPA", credits: 15 },
            { id: 5, name: "5th Semester GPA", credits: 14 },
            { id: 6, name: "6th Semester GPA", credits: 16 },
            { id: 7, name: "7th Semester GPA", credits: 18 },
            { id: 8, name: "8th Semester GPA", credits: 16 },
            { id: 9, name: "9th Semester GPA", credits: 17 },
            { id: 10, name: "10th Semester GPA", credits: 18 }
        ];

        const honorsGoals = [
            { name: "First Class", minCGPA: 3.70 },
            { name: "Second Upper", minCGPA: 3.30 },
            { name: "Second Lower", minCGPA: 3.00 }
        ];

        // --- UX HELPERS ---
        // Helper specifically for input placeholder context
        const PLACEHOLDER_TEXT = "0-4.0";

        // ============ UTILITY FUNCTIONS ============
        const safeStorage = {
            setItem: function (k, v) { try { localStorage.setItem(k, v); } catch (e) { } },
            getItem: function (k) { try { return localStorage.getItem(k); } catch (e) { return null; } },
            clear: function () { try { localStorage.clear(); } catch (e) { } }
        };

        function haptic(ms = 10) {
            if (navigator.vibrate) navigator.vibrate(ms);
        }

        // ============ BANNER LOGIC ============
        let bannerDismissedThisSession = false;

        function initBanner() {
            const banner = document.getElementById('star-banner');
            if (!banner) return;

            if (!bannerDismissedThisSession) {
                banner.style.display = 'flex';
            }

            const closeBtn = document.getElementById('banner-close');
            closeBtn.addEventListener('click', () => {
                haptic();
                bannerDismissedThisSession = true;
                banner.style.display = 'none';
            });
        }

        // ============ THEME MANAGEMENT ============
        function applyTheme(theme) {
            const btn = document.getElementById('theme-toggle');
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                if (btn) { btn.innerText = '‚òÄÔ∏è Light'; btn.setAttribute('aria-pressed', 'true'); }
            } else {
                document.documentElement.removeAttribute('data-theme');
                if (btn) { btn.innerText = 'üåô Dark'; btn.setAttribute('aria-pressed', 'false'); }
            }
            safeStorage.setItem('theme', theme);
        }

        function initTheme() {
            const saved = safeStorage.getItem('theme');
            let theme = 'light';
            if (saved === 'dark' || saved === 'light') theme = saved;
            else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) theme = 'dark';
            applyTheme(theme);

            // Attach toggle
            const btn = document.getElementById('theme-toggle');
            if (btn) btn.addEventListener('click', () => {
                haptic();
                const current = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'light';
                applyTheme(current === 'dark' ? 'light' : 'dark');
            });
        }


        // ============ MAIN APPLICATION LOGIC ============
        const container = document.getElementById('semester-inputs');
        const selectBox = document.getElementById('current-sem-select');
        const resetBtn = document.getElementById('reset-btn');

        function init() {
            initTheme();
            initBanner();
            renderInputsOnce();

            const saved = safeStorage.getItem('userCurrentSem');
            if (saved && Number(saved) >= 1) {
                selectBox.value = saved;
                updateVisibility();
            }

            selectBox.addEventListener('change', () => {
                haptic();
                updateVisibility();
            });

            resetBtn.addEventListener('click', () => {
                haptic(20);
                resetData();
            });
        }

        // ============ RENDER & VISIBILITY ============
        // Render all input rows once on page load (hidden by default)
        function renderInputsOnce() {
            container.innerHTML = '';

            semesterData.forEach((sem, idx) => {
                const row = document.createElement('div');
                row.className = 'semester-row';
                row.id = `sem-row-${idx}`; // ID for toggling visibility
                row.style.display = 'none'; // Hidden by default

                const info = document.createElement('div');
                const name = document.createElement('span');
                name.className = 'sem-name';
                name.id = `sem-name-${idx}`; // ID to update text (Normal vs Simulate)
                name.textContent = sem.name;

                const credits = document.createElement('span');
                credits.className = 'sem-credits';
                credits.textContent = `${sem.credits} Credits`;

                info.appendChild(name);
                info.appendChild(credits);

                const inputWrapper = document.createElement('div');
                inputWrapper.style.display = 'flex';
                inputWrapper.style.flexDirection = 'column';
                inputWrapper.style.alignItems = 'center';

                const input = document.createElement('input');
                input.type = 'number';
                input.id = `gpa-${idx}`;
                input.step = '0.01';
                input.min = '0';
                input.max = '4.0';
                input.placeholder = '-';
                input.inputMode = 'decimal';
                input.setAttribute('pattern', '[0-4](\\.[0-9]{1,2})?');

                // Helper label (Optional / Scale)
                const scaleHelper = document.createElement('small');
                scaleHelper.id = `helper-${idx}`;
                scaleHelper.style.fontSize = '0.65rem';
                scaleHelper.style.color = 'var(--muted)';
                scaleHelper.style.marginTop = '4px';
                scaleHelper.textContent = '';

                // Restore stored value if present
                const stored = safeStorage.getItem(`gpa_sem_${idx}`);
                if (stored) input.value = stored;

                // Attach listeners
                input.addEventListener('input', () => {
                    haptic(5);
                    handleInput(input, idx);
                });

                // Auto-format on blur
                input.addEventListener('blur', () => {
                    const v = parseFloat(input.value);
                    if (Number.isFinite(v) && v >= 0 && v <= 4.0) {
                        input.value = v.toFixed(2);
                        safeStorage.setItem(`gpa_sem_${idx}`, input.value);
                        recalc();
                    }
                });

                inputWrapper.appendChild(input);
                inputWrapper.appendChild(scaleHelper);

                row.appendChild(info);
                row.appendChild(inputWrapper);

                container.appendChild(row);
            });

            // Initial recalc to restore state
            recalc();
        }

        // Show/hide inputs based on completed semesters
        function updateVisibility() {
            const level = parseInt(selectBox.value);
            if (isNaN(level) || level === 0) return;

            safeStorage.setItem('userCurrentSem', level);

            const hint = document.getElementById('start-hint');
            if (hint) hint.style.display = 'none';

            // Show exactly 'level' number of semester inputs (completed semesters)
            semesterData.forEach((sem, idx) => {
                const row = document.getElementById(`sem-row-${idx}`);
                if (!row) return;

                const nameLabel = document.getElementById(`sem-name-${idx}`);
                const helper = document.getElementById(`helper-${idx}`);

                if (idx < level) {
                    // Show this semester (it's completed)
                    row.style.display = 'flex';
                    if (nameLabel) nameLabel.textContent = sem.name;
                    if (helper) helper.textContent = '';
                } else {
                    // Hide future semesters
                    row.style.display = 'none';
                }
            });

            recalc();
        }

        // ============ INPUT VALIDATION & HANDLING ============
        function handleInput(input, idx) {
            const v = parseFloat(input.value);
            const wrapper = input.parentElement;
            let errorMsg = wrapper.querySelector('.error-msg');

            // Determine error type
            let errorText = '';
            if (input.value !== '' && !Number.isFinite(v)) {
                errorText = 'Please enter a valid number';
            } else if (v < 0) {
                errorText = 'GPA cannot be negative';
            } else if (v > 4.0) {
                errorText = 'GPA must be 0.00 - 4.00';
            }

            // Show/hide error message and apply states
            if (errorText) {
                input.classList.add('error');
                input.classList.remove('valid');
                if (!errorMsg) {
                    errorMsg = document.createElement('small');
                    errorMsg.className = 'error-msg';
                    wrapper.appendChild(errorMsg);
                }
                errorMsg.textContent = errorText;
            } else {
                input.classList.remove('error');
                if (errorMsg) errorMsg.remove();

                // Apply valid state if there's a value
                if (input.value !== '' && Number.isFinite(v) && v >= 0 && v <= 4.0) {
                    input.classList.add('valid');
                    safeStorage.setItem(`gpa_sem_${idx}`, input.value);
                } else {
                    input.classList.remove('valid');
                }
            }
            recalc();
        }

        // ============ HONOURS TIER DETECTION ============
        function getHonoursTier(cgpa) {
            if (cgpa >= 3.70) return 'first';   // First Class - Green
            if (cgpa >= 3.00) return 'second';  // Second Class - Yellow
            return 'below';                      // Below Second - Red
        }

        function updateCGPAColor(cgpa) {
            const tier = getHonoursTier(cgpa);
            const cgpaValue = document.querySelector('.cgpa-value');
            const cgpaBox = document.querySelector('.cgpa-box');

            if (!cgpaValue || !cgpaBox) return;

            // Remove all tier classes
            const tierClasses = ['tier-first', 'tier-second', 'tier-below'];
            cgpaValue.classList.remove(...tierClasses);
            cgpaBox.classList.remove(...tierClasses);

            // Add current tier class
            cgpaValue.classList.add(`tier-${tier}`);
            cgpaBox.classList.add(`tier-${tier}`);
        }

        // ============ CGPA CALCULATION ============
        function recalc() {
            const totalDegreeCredits = semesterData.reduce((sum, s) => sum + s.credits, 0);

            let completedCredits = 0, totalGradePoints = 0;
            const currentLevel = parseInt(selectBox.value) || 0;

            semesterData.forEach((sem, i) => {
                const el = document.getElementById(`gpa-${i}`);
                // Only include semesters within the selected range
                if (el && el.value !== "" && (i + 1) <= currentLevel) {

                    const v = parseFloat(el.value);
                    if (Number.isFinite(v) && v >= 0 && v <= 4.0) {
                        totalGradePoints += (v * sem.credits);
                        completedCredits += sem.credits;
                    }
                }
            });



            const panel = document.getElementById('results-panel');
            if (completedCredits === 0) { panel.style.display = 'none'; return; }

            panel.style.display = 'block';
            const cgpa = totalGradePoints / completedCredits;
            const cgpaEl = document.getElementById('final-cgpa');
            cgpaEl.innerText = isFinite(cgpa) ? cgpa.toFixed(2) : '0.00';
            document.getElementById('completed-credits').innerText = completedCredits;

            // Update CGPA color based on honours tier
            updateCGPAColor(cgpa);

            // Update Progress Indicator
            updateProgressIndicator(completedCredits, totalDegreeCredits);

            // Calculate Future
            const remCr = totalDegreeCredits - completedCredits;
            const list = document.getElementById('goals-list');
            list.innerHTML = '';

            honorsGoals.forEach(g => {
                let html = '';
                if (remCr <= 0) {
                    html = cgpa >= g.minCGPA ? '<span class="status-track">Achieved ‚úÖ</span>' : '<span class="status-impossible">Missed ‚ùå</span>';
                } else {
                    const reqRaw = ((g.minCGPA * totalDegreeCredits) - totalGradePoints) / remCr;
                    const req = reqRaw;

                    if (req > 4.0) html = '<span class="status-impossible">Unattainable ‚ùå</span>';
                    else if (req <= 0) html = '<span class="status-track">Secured ‚úÖ</span>';
                    else if (isFinite(cgpa) && cgpa >= req) html = '<span class="status-track">On Track ‚úÖ</span>';
                    else html = `<span class="goal-val">${Math.min(4.0, Math.max(0, req)).toFixed(2)}</span>`;
                }

                // Determine upcoming semesters (count of semesters left based on inputs entered AND selected range)
                const completedSemestersCount = semesterData.reduce((c, s, i) => {
                    const el = document.getElementById(`gpa-${i}`);
                    // Only count if valid AND within the selected range
                    return c + (el && el.value !== '' && (i + 1) <= currentLevel ? 1 : 0);
                }, 0);
                const upcomingSemesters = Math.max(0, semesterData.length - completedSemestersCount);

                // Build subtext explaining the required average across upcoming semesters
                let subtext = '';
                if (remCr <= 0) {
                    subtext = '';
                } else {
                    const reqAcross = ((g.minCGPA * totalDegreeCredits) - totalGradePoints) / remCr;
                    if (!isFinite(reqAcross)) subtext = '';
                    else if (reqAcross > 4.0) subtext = `In upcoming ${upcomingSemesters} semesters you would need an average ‚â• ${reqAcross.toFixed(2)} (Unattainable).`;
                    else if (reqAcross <= 0) subtext = `No additional average required ‚Äî goal secured.`;
                    else subtext = `In upcoming ${upcomingSemesters} semesters your average should be ‚â• ${Math.min(4.0, Math.max(0, reqAcross)).toFixed(2)}.`;
                }

                const li = document.createElement('li');
                li.className = 'goal-item';
                li.innerHTML = `
                <div>
                    ${g.name} <small class="muted">(${g.minCGPA})</small>
                    ${subtext ? `<div class="muted-small">${subtext}</div>` : ''}
                </div>
                <div>${html}</div>
            `;
                list.appendChild(li);
            });
        }

        function updateProgressIndicator(completedCredits, totalCredits) {
            // Get current semester limit
            const selectBox = document.getElementById('current-sem-select');
            const currentLevel = parseInt(selectBox.value) || 0;

            // Count completed semesters (those with valid GPA entries AND within selected range)
            const completedSemesters = semesterData.reduce((count, sem, i) => {
                const el = document.getElementById(`gpa-${i}`);
                return count + (el && el.value !== '' && !el.classList.contains('error') && (i + 1) <= currentLevel ? 1 : 0);
            }, 0);

            const totalSemesters = semesterData.length;
            const progressPercentage = Math.round((completedSemesters / totalSemesters) * 100);

            // Update progress bar
            const progressBar = document.getElementById('progress-bar-fill');
            if (progressBar) {
                progressBar.style.width = `${progressPercentage}%`;
            }

            // Update stats text
            const statsEl = document.getElementById('progress-stats');
            if (statsEl) {
                statsEl.textContent = `${completedSemesters}/${totalSemesters} semesters`;
            }

            // Update percentage text
            const percentEl = document.getElementById('progress-percentage');
            if (percentEl) {
                percentEl.textContent = `${progressPercentage}% Complete`;
            }
        }





        let resetTimeout;
        function resetData() {
            const btn = document.getElementById('reset-btn');

            if (btn.classList.contains('confirm-state')) {
                // Second tap - Execute Clear
                haptic(50); // Heavy vibration
                safeStorage.clear();
                location.reload();
            } else {
                // First tap - Request Confirmation
                haptic(10);
                btn.classList.add('confirm-state');
                const originalText = btn.textContent;
                btn.textContent = "‚ö†Ô∏è Tap again to Confirm";

                // Clear existing timeout if any
                if (resetTimeout) clearTimeout(resetTimeout);

                // Auto-reset after 3 seconds
                resetTimeout = setTimeout(() => {
                    btn.classList.remove('confirm-state');
                    btn.textContent = "Clear Data";
                }, 3000);
            }
        }

        init();
    </script>
</body>


</html>